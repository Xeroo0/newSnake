{"version":3,"sources":["../../../../assets/script/assets/script/HeroControl.js"],"names":["MOVE_LEFT","MOVE_RIGHT","MOVE_UP","MOVE_DOWN","cc","Class","extends","Component","properties","speed","moveDelayed","tailNode","default","type","Node","onLoad","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","body","getComponent","RigidBody","moveStage","time","live","init","params","GameJs","event","keyCode","KEY","w","a","s","d","reset","deleteTail","node","position","v2","update","dt","oldPosition","x","y","offset","updateTailPositon","i","_children","length","onBeginContact","contact","selfCollider","otherCollider","tag","gameOver","log","parent","destroy","grtScore"],"mappings":"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","file":"HeroControl.js","sourceRoot":"../../../../assets/script","sourcesContent":["\nconst MOVE_LEFT = 1\nconst MOVE_RIGHT = 2\nconst MOVE_UP = 3\nconst MOVE_DOWN = 4\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        speed: 10,\n        moveDelayed: 1,\n        tailNode:{\n            default: null,\n            type: cc.Node\n        }\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        this.body = this.getComponent(cc.RigidBody)\n        this.moveStage = MOVE_RIGHT\n        this.time = 0\n        this.live = false\n    },\n\n    init : function (params) {\n        this.GameJs = params.GameJs\n    },\n\n    onKeyDown (event) {\n        switch (event.keyCode) {\n            case cc.KEY.w:\n                if(this.moveStage != MOVE_DOWN)\n                    this.moveStage = MOVE_UP\n                break;\n            case cc.KEY.a:\n                if (this.moveStage != MOVE_RIGHT)\n                    this.moveStage = MOVE_LEFT\n                break;\n            case cc.KEY.s:\n                if (this.moveStage != MOVE_UP)\n                    this.moveStage = MOVE_DOWN\n                break;\n            case cc.KEY.d:\n                if (this.moveStage != MOVE_LEFT)\n                    this.moveStage = MOVE_RIGHT\n                break; \n            default:\n                break;\n        }\n    },\n\n    reset : function () {\n        this.deleteTail()\n        this.moveStage = MOVE_RIGHT\n        this.time = 0\n        this.live = true\n        this.node.position = cc.v2(0,0)\n    },\n\n    update (dt) {\n        //this.speed = this.body.linearVelocity;\n        this.time += dt\n        if (this.time >= this.moveDelayed && this.live) {\n            this.node.oldPosition = cc.v2(this.node.x, this.node.y)\n            if (this.moveStage == MOVE_LEFT) {\n                this.node.x -= this.speed\n            }\n            else if (this.moveStage == MOVE_RIGHT) {\n                this.node.x += this.speed\n            }\n            else if (this.moveStage == MOVE_UP) {\n                this.node.y += this.speed\n            }\n            else if (this.moveStage == MOVE_DOWN) {\n                this.node.y -= this.speed\n            }\n            this.node.offset = cc.v2(this.node.x - this.node.oldPosition.x, this.node.y - this.node.oldPosition.y)\n            this.updateTailPositon()\n            this.time = 0\n        }\n        //this.body.linearVelocity = this.speed\n    },\n\n    updateTailPositon()\n    {\n        for(let i = 0; i < this.tailNode._children.length; i++)\n        {\n            if (this.tailNode._children.length - i - 1 == 0)\n            {\n                this.tailNode._children[this.tailNode._children.length - i - 1].position = this.node.oldPosition\n            }\n            else\n            {\n                this.tailNode._children[this.tailNode._children.length - i - 1].position = this.tailNode._children[this.tailNode._children.length - i - 2].position\n            }\n            \n        }\n    },\n\n    onBeginContact: function (contact, selfCollider, otherCollider) {\n        if (otherCollider.tag === 999) {\n            this.live = false\n            this.GameJs.gameOver()\n            return cc.log(\"GAME OVER\")\n        }\n        otherCollider.node.parent = this.tailNode\n    },\n\n    deleteTail()\n    {\n        let i = 0\n        while (this.tailNode._children.length) {\n            this.tailNode._children[i].destroy()\n            i++\n            if (i >= this.tailNode._children.length) {\n                return\n            }\n        }\n    },\n\n    grtScore()\n    {\n        return this.tailNode._children.length\n    }\n});\n"]}